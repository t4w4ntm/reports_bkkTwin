<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard — Reports | BangkokTwin</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
            orbitron: ['Orbitron', 'system-ui', 'sans-serif']
          }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Orbitron:wght@600;800&display=swap" rel="stylesheet">

  <style>
    html, body { height: 100%; }
    body {
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
      background: #0b1220;
      color: #e6f0ff;
    }

    /* Ambient mesh background — soft & subtle (no canvas) */
    .bg-ambient {
      position: fixed; inset: 0; z-index: -10; opacity: .65;
      background:
        radial-gradient(35rem 25rem at 20% 15%, rgba(34,197,94,.25), transparent 60%),
        radial-gradient(45rem 35rem at 80% 10%, rgba(56,189,248,.20), transparent 60%),
        radial-gradient(50rem 35rem at 70% 85%, rgba(99,102,241,.18), transparent 60%),
        linear-gradient(180deg, #0b1220 0%, #0f1a2e 100%);
      filter: saturate(105%);
      animation: ambientShift 22s ease-in-out infinite alternate;
    }
    @keyframes ambientShift {
      0%   { filter: hue-rotate(0deg) saturate(105%); }
      100% { filter: hue-rotate(12deg) saturate(115%); }
    }
    @media (prefers-reduced-motion: reduce) {
      .bg-ambient { animation: none; }
    }

    /* Glass card feel — iOS-like glowing edge */
    .glass {
      position: relative;
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(10px) saturate(120%);
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 10px 30px rgba(2,8,23,0.35);
    }
    .glass::before {
      content: "";
      position: absolute;
      inset: 0;
      padding: 1px; /* border width */
      border-radius: inherit;
      background: conic-gradient(from 210deg at 50% 50%,
        rgba(255,255,255,.55),
        rgba(99,102,241,.35), /* indigo */
        rgba(56,189,248,.35), /* sky */
        rgba(16,185,129,.40), /* emerald */
        rgba(255,255,255,.55)
      );
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
      opacity: .55;
    }
    .glass::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background:
        radial-gradient(120% 60% at 0% 0%, rgba(255,255,255,.18), rgba(255,255,255,0) 60%),
        radial-gradient(100% 60% at 100% 0%, rgba(255,255,255,.08), rgba(255,255,255,0) 60%);
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: .5;
    }

    /* Status pills */
    .pill { display:inline-flex; align-items:center; border-radius:9999px; padding:0.25rem 0.625rem; font-size:0.75rem; font-weight:600; }
    .pill-pending  { background: rgba(234,179,8,0.15);  color:#fde68a; box-shadow: 0 0 0 1px rgba(234,179,8,.30) inset; }
    .pill-verified { background: rgba(16,185,129,0.15); color:#86efac; box-shadow: 0 0 0 1px rgba(16,185,129,.30) inset; }
    .pill-rejected { background: rgba(244,63,94,0.15);  color:#fda4af; box-shadow: 0 0 0 1px rgba(244,63,94,.30) inset; }
    .pill-resolved { background: rgba(59,130,246,0.15); color:#93c5fd; box-shadow: 0 0 0 1px rgba(59,130,246,.30) inset; }

    /* Hide scrollbar for chip row overflow */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Simple line clamp (no plugin) */
  .clamp-1 { display:-webkit-box; -webkit-line-clamp:1; line-clamp:1; -webkit-box-orient:vertical; overflow:hidden; }
  .clamp-2 { display:-webkit-box; -webkit-line-clamp:2; line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }

    /* Select dropdown styling */
    select option {
      background: #1e293b !important;
      color: #e6f0ff !important;
      padding: 8px 12px !important;
      border: none !important;
    }
    select option:hover {
      background: #334155 !important;
    }
    select option:checked,
    select option:active {
      background: #1e40af !important;
      color: #ffffff !important;
    }

    /* Interactive affordances */
    a, button, [role="button"], .filter-chip, label[for] {
      transition: transform .18s ease, box-shadow .2s ease, filter .2s ease, background-color .2s ease, opacity .2s ease;
      will-change: transform, box-shadow, filter;
    }
    a:hover, button:hover, [role="button"]:hover, .filter-chip:hover, label[for]:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(2,8,23,.45), 0 0 0 1px rgba(148,163,184,.25) inset, 0 0 16px rgba(56,189,248,.22);
    }
    a:active, button:active, [role="button"]:active, .filter-chip:active, label[for]:active {
      transform: translateY(-1px) scale(0.98);
      filter: brightness(1.03);
    }
    a:focus-visible, button:focus-visible, [role="button"]:focus-visible, .filter-chip:focus-visible, label[for]:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(56,189,248,.45), 0 0 0 1px rgba(255,255,255,.7) inset;
    }

    /* Modal open animations */
    #detailModal .modal-overlay { opacity: 0; }
    #detailModal .modal-panel { opacity: 0; transform: translateY(8px) scale(0.98); }
    #detailModal:not(.hidden) .modal-overlay { animation: modalFadeIn 220ms ease forwards; }
    #detailModal:not(.hidden) .modal-panel { animation: modalPopIn 260ms cubic-bezier(.2,.8,.2,1) forwards; }
    @keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes modalPopIn { from { opacity: 0; transform: translateY(8px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
    @media (prefers-reduced-motion: reduce) {
      #detailModal:not(.hidden) .modal-overlay,
      #detailModal:not(.hidden) .modal-panel { animation: none; opacity: 1; transform: none; }
    }

    /* Responsive: modal sizing and map heights */
    @media (max-width: 1024px) {
      #detailModal .modal-panel { margin: 1rem; width: auto; }
    }
    @media (max-width: 640px) {
      #detailModal .modal-panel { margin: .75rem; width: auto; }
      #detailModal #modalMap { height: 220px; }
    }
  </style>
</head>
<body class="min-h-full">
  <div class="bg-ambient"></div>

  <!-- Page wrapper -->
  <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
    <!-- Top bar -->
    <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-xl bg-emerald-400/20 ring-1 ring-emerald-400/30 grid place-items-center">
            <span class="text-emerald-300 font-orbitron font-bold">BT</span>
          </div>
          <h1 class="text-2xl font-bold font-orbitron tracking-wide">BangkokTwin — Admin</h1>
        </div>
        <p class="text-slate-300/85 text-sm mt-1">Moderate and manage citizen reports in real-time.</p>
      </div>
      <div class="flex items-center gap-2">
        <a href="index.html" class="inline-flex items-center gap-2 rounded-xl bg-white/10 hover:bg-white/15 transition px-3.5 py-2 text-sm ring-1 ring-white/15">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M15 18l-6-6 6-6"/></svg>
          Back to Submit
        </a>
        <button id="btn-refresh" class="inline-flex items-center gap-2 rounded-xl bg-emerald-500/90 hover:bg-emerald-500 transition px-3.5 py-2 text-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 12a9 9 0 1 1-6.219-8.56"/><path d="M21 12a9 9 0 0 1-9 9"/><path d="M3.6 9h4.8v4.8"/></svg>
          Refresh
        </button>
        <button id="btn-logout" class="inline-flex items-center gap-2 rounded-xl bg-red-500/90 hover:bg-red-500 transition px-3.5 py-2 text-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          Logout
        </button>
      </div>
    </div>

    <!-- Controls -->
  <div class="glass mt-6 rounded-2xl ring-1 ring-white/10 p-4 sm:p-5">
      <div class="grid grid-cols-1 md:grid-cols-12 gap-3">
        <div class="md:col-span-5">
          <label class="text-xs uppercase tracking-wider text-slate-300/80">Search</label>
          <div class="mt-1 relative">
            <input id="searchInput" type="text" placeholder="ค้นหาด้วยหัวข้อ, คำอธิบาย, ผู้แจ้ง, สถานที่…"
              class="w-full rounded-xl bg-white/5 ring-1 ring-white/10 focus:ring-emerald-400/40 focus:ring-2 outline-none px-3.5 py-2.5 placeholder:text-slate-400" />
            <button id="clearSearch" class="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-lg hover:bg-white/10 hidden" aria-label="Clear search">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6 6 18M6 6l12 12"/></svg>
            </button>
          </div>
        </div>
        <div class="md:col-span-4">
          <label class="text-xs uppercase tracking-wider text-slate-300/80">Status</label>
          <div class="mt-1 flex gap-2 overflow-x-auto no-scrollbar">
            <button data-status="all" class="filter-chip active px-3 py-2 rounded-lg bg-white/10 ring-1 ring-white/10 text-sm whitespace-nowrap">All</button>
            <button data-status="pending" class="filter-chip px-3 py-2 rounded-lg hover:bg-white/10 ring-1 ring-white/10 text-sm whitespace-nowrap">Pending</button>
            <button data-status="verified" class="filter-chip px-3 py-2 rounded-lg hover:bg-white/10 ring-1 ring-white/10 text-sm whitespace-nowrap">Verified</button>
            <button data-status="resolved" class="filter-chip px-3 py-2 rounded-lg hover:bg-white/10 ring-1 ring-white/10 text-sm whitespace-nowrap">Resolved</button>
            <button data-status="rejected" class="filter-chip px-3 py-2 rounded-lg hover:bg-white/10 ring-1 ring-white/10 text-sm whitespace-nowrap">Rejected</button>
          </div>
        </div>
        <div class="md:col-span-3">
          <label class="text-xs uppercase tracking-wider text-slate-300/80">Sort</label>
          <select id="sortSelect" class="mt-1 w-full rounded-xl bg-white/5 ring-1 ring-white/10 focus:ring-emerald-400/40 focus:ring-2 outline-none px-3 py-2.5 text-sm">
            <option value="createdAt-desc">Newest first</option>
            <option value="createdAt-asc">Oldest first</option>
          </select>
        </div>
      </div>

      <!-- Bulk actions -->
      <div class="mt-4 flex items-center gap-2">
        <button id="bulkVerify" class="inline-flex items-center gap-2 rounded-xl bg-emerald-500/90 hover:bg-emerald-500 transition px-3.5 py-2 text-sm disabled:opacity-40 disabled:cursor-not-allowed" disabled>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20 6L9 17l-5-5"/></svg>
          Approve selected
        </button>
        <button id="bulkReject" class="inline-flex items-center gap-2 rounded-xl bg-rose-500/90 hover:bg-rose-500 transition px-3.5 py-2 text-sm disabled:opacity-40 disabled:cursor-not-allowed" disabled>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6L6 18M6 6l12 12"/></svg>
          Reject selected
        </button>
        <span id="selectionCount" class="ml-2 text-xs text-slate-300/80 hidden"></span>
      </div>
    </div>

    <!-- Table -->
  <div class="glass mt-6 rounded-2xl ring-1 ring-white/10 overflow-hidden">
      <div class="px-4 sm:px-6 py-3 flex items-center justify-between">
        <h2 class="text-base font-semibold">Reports</h2>
        <span id="resultCount" class="text-xs text-slate-300/80"></span>
      </div>
      <div class="overflow-x-auto">
    <table class="w-full text-sm">
          <thead class="bg-white/5 text-slate-300">
            <tr>
              <th class="text-left font-semibold px-4 py-3"><input id="selectAll" type="checkbox" class="w-4 h-4" aria-label="Select all"></th>
              <th class="text-left font-semibold px-4 py-3">Report</th>
              <th class="text-left font-semibold px-4 py-3">Location</th>
              <th class="text-left font-semibold px-4 py-3">Status</th>
              <th class="text-left font-semibold px-4 py-3">Created</th>
              <th class="text-left font-semibold px-4 py-3">Actions</th>
            </tr>
          </thead>
          <tbody id="tableBody" class="divide-y divide-white/5"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Detail Modal -->
  <div id="detailModal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
    <div class="absolute inset-0 bg-black/60 modal-overlay"></div>
    <div class="relative mx-auto my-8 max-w-3xl glass rounded-2xl ring-1 ring-white/10 modal-panel">
      <div class="flex items-center justify-between px-5 py-4 border-b border-white/10">
        <h3 id="modalTitle" class="text-lg font-semibold">Report detail</h3>
        <button id="closeModal" class="p-2 rounded-lg hover:bg-white/10" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6 6 18M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="p-5 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <img id="modalImage" alt="" class="w-full aspect-video object-cover rounded-xl ring-1 ring-white/10 bg-white/5">
          <div class="mt-3 text-sm" id="modalDesc"></div>
        </div>
        <div class="space-y-3">
          <div class="text-sm">
            <div class="text-slate-300/80">Created At</div>
            <div id="modalCreatedAt" class="font-medium"></div>
          </div>

          <div class="text-sm">
            <div class="text-slate-300/80">Location</div>
            <div id="modalLocation" class="font-medium"></div>
            <div class="mt-2 rounded-xl overflow-hidden ring-1 ring-white/10">
              <iframe id="modalMap" class="w-full h-56" loading="lazy" referrerpolicy="no-referrer-when-downgrade" title="map"></iframe>
            </div>
          </div>
          <div class="flex gap-2 pt-2">
            <button id="modalApprove" class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-emerald-500/90 hover:bg-emerald-500 transition px-3.5 py-2 text-sm">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20 6L9 17l-5-5"/></svg>
              Approve
            </button>
            <button id="modalResolve" class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-sky-500/90 hover:bg-sky-500 transition px-3.5 py-2 text-sm">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M5 13l4 4L19 7"/></svg>
              Resolve
            </button>
            <button id="modalReject" class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-rose-500/90 hover:bg-rose-500 transition px-3.5 py-2 text-sm">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M18 6L6 18M6 6l12 12"/></svg>
              Reject
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-[60] hidden">
    <div class="rounded-xl bg-black/80 text-white px-4 py-2 text-sm ring-1 ring-white/15" id="toastText">Saved</div>
  </div>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
    // ใช้ค่าเดียวกับโปรเจกต์ของคุณ (คงค่าจากไฟล์เดิม)
    const firebaseConfig = {
      apiKey: "AIzaSyAddqe5R7F1lu-i5JCE6Hk0wWy1M24ryXE",
      authDomain: "reporttwinbkk.firebaseapp.com",
      projectId: "reporttwinbkk",
      storageBucket: "reporttwinbkk.firebasestorage.app",
      messagingSenderId: "495679642018",
      appId: "1:495679642018:web:e2b4c49d1db57f36ebbafb"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <!-- Authentication -->
  <script src="simple-auth.js"></script>
  
  <!-- App logic -->
  <script src="reports.js"></script>
  
  <script>
    // Add logout functionality when page loads
    document.addEventListener('DOMContentLoaded', function() {
      const logoutBtn = document.getElementById('btn-logout');
      if (logoutBtn && window.simpleAdminAuth) {
        logoutBtn.addEventListener('click', function() {
          window.simpleAdminAuth.logout();
        });
      }
    });
  </script>
</body>
</html>
